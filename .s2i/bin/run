#!/bin/bash

echo "---> Starting StickyTux application"

# Ensure data directories exist
mkdir -p /app/data /app/media

# Run database migrations on startup
echo "---> Running database migrations"
python manage.py migrate --noinput

# Start Django with Gunicorn using ASGI for WebSocket support
exec gunicorn backend.asgi:application \
    --bind 0.0.0.0:8080 \
    --worker-class uvicorn.workers.UvicornWorker \
    --workers ${WEB_CONCURRENCY:-4} \
    --timeout 60 \
    --keep-alive 2 \
    --max-requests 1000 \
    --access-logfile - \
    --error-logfile -